"use strict";var DownloadTaskBody=$("#DownloadTaskBody"),task2Html=function(s){var e="";return e+='<div class="task'+(s.error?" error":1==s.progress?" complete":"")+'" pixiv_id="'+s.pixiv_id+'"><div class="pixiv_id">Pixiv ID: '+s.pixiv_id+"</div>",e+='<div class="title">'+s.title+'</div><div><span class="progress_text">'+s.infotext+'</span><a class="retry" href="javascript:void(0);">重试</a><div style="clear:both;"></div></div>',e+='<div class="progress_body"><div class="progress_value" style="width:'+100*s.progress+'%;"></div></div></div>'},BackgroundPort=chrome.runtime.connect({name:"PopupOpened"});BackgroundPort.onMessage.addListener(function(s,e,a){if("RefreshDownloadTaskList"===s.event){var r="";if(s.tasks.length>0)for(var t=0;t<s.tasks.length;t++){var o=s.tasks[t];r+=task2Html(o)}else r='<div class="no_task">没有任务</div>';DownloadTaskBody.html(r)}else if("RefreshDownloadTask"===s.event){var i=s.task,d=DownloadTaskBody.find("div.task[pixiv_id="+i.pixiv_id+"]");if(d.length>0)d.find("span.progress_text").text(i.infotext),d.find("div.progress_value").css("width",100*i.progress+"%"),i.title&&d.find("div.title").text(i.title),i.error?(d.hasClass("complete")&&d.removeClass("complete"),d.hasClass("error")||d.addClass("error")):1==i.progress?(d.hasClass("error")&&d.removeClass("error"),d.hasClass("complete")||d.addClass("complete")):(d.hasClass("error")&&d.removeClass("error"),d.hasClass("complete")&&d.removeClass("complete"));else{var l=task2Html(i);DownloadTaskBody.append($(l))}}}),BackgroundPort.postMessage({event:"GetDownloadTask"}),$("#ClearTaskList").click(function(){return BackgroundPort.postMessage({event:"ClearTaskList"}),!1}),$(document).on("click","div.task a.retry",function(){var s=$(this).closest("div.task").attr("pixiv_id");return BackgroundPort.postMessage({event:"DownloadRetry",PixivId:s}),!1});